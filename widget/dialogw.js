function ck_dump(){console.log("-------------------------------"),console.log("------ДИНАМИЧЕСКИЕ ДАННЫЕ------"),console.log("-------------------------------"),console.log("ВЕРСИЯ СКРИПТА.............callkeep_vers.....= "+DialogWidget.globalDW.client_memory.getItem("callkeep_vers")),console.log("ИСТОЧНИК ВХОДА.............callkeep_rfr......= "+DialogWidget.globalDW.client_memory.getItem("callkeep_rfr")),console.log("ТОЧКА ВХОДА................callkeep_ep.......= "+DialogWidget.globalDW.client_memory.getItem("callkeep_ep")),console.log("ЗАГОЛОВОК ТОЧКИ ВХОДА......callkeep_ept......= "+DialogWidget.globalDW.client_memory.getItem("callkeep_ept")),console.log("h1 ТОЧКИ ВХОДА.............callkeep_eph1.....= "+DialogWidget.globalDW.client_memory.getItem("callkeep_eph1")),console.log("_openstat..................callkeep_os.......= "+DialogWidget.globalDW.client_memory.getItem("callkeep_os")),console.log("utm_campaign...............callkeep_utmcamp..= "+DialogWidget.globalDW.client_memory.getItem("callkeep_utmcamp")),console.log("utm_source.................callkeep_utmsrc...= "+DialogWidget.globalDW.client_memory.getItem("callkeep_utmsrc")),console.log("gclid......................callkeep_gclid....= "+DialogWidget.globalDW.client_memory.getItem("callkeep_gclid")),console.log("СОСТОЯНИЕ..................callkeep_cst......= "+DialogWidget.globalDW.client_memory.getItem("callkeep_cst")),console.log("СЧЁТ.......................callkeep_cs.......= "+DialogWidget.globalDW.client_memory.getItem("callkeep_cs")),console.log("АКТИВНЫЕ ОКНА..............callkeep_aw.......= "+DialogWidget.globalDW.client_memory.getItem("callkeep_aw")),console.log("ОТВЕТСТВЕННЫЙ..............callkeep_rflc.....= "+DialogWidget.globalDW.client_memory.getItem("callkeep_rflc")),console.log("ПОСЛЕДНЯЯ АКТИВАЦИЯ........callkeep_lat......= "+DialogWidget.globalDW.client_memory.getItem("callkeep_lat")),console.log("ПОСЛЕДНЕЕ ЗАКРЫТИЕ.........callkeep_lct......= "+DialogWidget.globalDW.client_memory.getItem("callkeep_lct")),console.log("ПОСЛЕДНЯЯ ОТПРАВКА.........callkeep_lst......= "+DialogWidget.globalDW.client_memory.getItem("callkeep_lst")),console.log("ПЕРВАЯ ОТПРАВКА............callkeep_fst......= "+DialogWidget.globalDW.client_memory.getItem("callkeep_fst")),console.log("ВСЕГО ОТПРАВЛЕНО...........callkeep_ts.......= "+DialogWidget.globalDW.client_memory.getItem("callkeep_ts")),console.log("ОБЩЕЕ ВРЕМЯ НА САЙТЕ.......callkeep_summsec..= "+DialogWidget.globalDW.client_memory.getItem("callkeep_summsec")),console.log("--------------------------"),console.log("---------НАСТРОЙКИ--------"),console.log("--------------------------"),console.log("ДАМП ОСН. ОБЪЕКТА...callkeep_main......: "),console.log(JSON.parse(DialogWidget.globalDW.client_memory.getItem("callkeep_main"))),console.log("ДАМП УСЛОВИЙ........callkeep_act_cond..: "),console.log(JSON.parse(DialogWidget.globalDW.client_memory.getItem("callkeep_act_cond")))}function ck_clear(){DialogWidget.globalDW.client_memory.clear()}var DialogWidget={};DialogWidget.DW=function(){function e(e){function t(){function e(){for(var e=t,i=0,o=0,l=e.act_cond.length;l>o;o++)e.act_cond[o]&&(i+=e.act_cond[o].giveSumScore());e.client_memory.setItem("callkeep_cs",parseFloat(e.client_memory.getItem("callkeep_cs"))+i),e.imActive(),ck_debug_periods&&console.log(e.client_memory.getItem("callkeep_cs")+" - "+e.client_memory.getItem("callkeep_aw")+"      ГЛАВНЫЙ-> "+e.client_memory.getItem("callkeep_rflc")+"       Я ГЛАВНЫЙ ->"+e.im_responsible+"        я один ->"+e.im_only_one+"       мой id -> "+e.ck_id),e.client_memory.getItem("callkeep_cs")>=e.fas||"form_was_activated"==e.client_memory.getItem("callkeep_cst")?(e.activatePopup(),e.stopKeeping(),e.clearScore(),e.waitOpenedForm()):"form_was_submitted"==e.client_memory.getItem("callkeep_cst")&&(ck_debug&&console.log("curr_total_score_watcher(): - форма была отправлена. Останавливаю отслеживание и сбрасываю счёт..."),e.stopKeeping(),e.clearScore())}ck_debug&&console.log("startKeeping(): - начинаю отслеживать действия пользователя...");var t=o;if(o.client_memory.setItem("callkeep_cst","keeping"),t.keeping_interval)return void(ck_debug&&console.log("startKeeping(): - keeping_interval не null, значит отслеживание уже запущено. ничего не делаю."));for(var i=0,l=o.act_cond.length;l>i;i++)o.act_cond[i]&&o.act_cond[i].startWatching();t.keeping_interval=setInterval(e,1e3)}function i(){o.im_responsible?(o.summsec++,o.client_memory.setItem("callkeep_summsec",o.summsec)):(o.summsec=o.client_memory.getItem("callkeep_summsec"),o.summsec||(o.summsec=0))}Object.defineProperty(this,"act_cond",{value:[],writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"version",{value:"2.3",writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"second_load",{value:!1,writable:!0,enumerable:!1,configurable:!0}),this.wid=e,this.summsec=0,Object.defineProperty(this,"summsec_interval",{value:null,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"cp",{value:"",writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"empty_phrase",{value:!1,writable:!0,enumerable:!1,configurable:!0}),this.wtp="",this.nwtp="",this.wth="",this.nwth="",Object.defineProperty(this,"ch",{value:"",writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"wtah",{value:"",writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"nwtah",{value:"",writable:!0,enumerable:!1,configurable:!0}),this.lhint="",Object.defineProperty(this,"ahint",{value:"",writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"chint",{value:"",writable:!0,enumerable:!1,configurable:!0}),this.sbe=null,this.sbs=null,this.lt,Object.defineProperty(this,"whacp",{value:"",writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"nwhacp",{value:"",writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"cpt",{value:"",writable:!0,enumerable:!1,configurable:!0}),this.lpt="",this.fas,this.rat,this.raast,this.srct,this.srcs,this.ya_c,Object.defineProperty(this,"rfr",{value:"",writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"dp",{value:"//service.dialogwidget.ru/widget",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(this,"fc",{value:"//service.dialogwidget.ru",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(this,"keeping_interval",{value:null,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"start_keeping_timer",{value:null,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"waiting_interval",{value:null,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"waiting_active_interval",{value:null,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"client_memory",{value:this.defineClientStorage(),writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"ck_id",{value:(new Date).getTime()+"",writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"im_responsible",{value:!1,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"im_only_one",{value:!1,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"i_acted",{value:!1,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"popup_is_shown",{value:!1,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"last_presence_time",{value:!1,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"spec_keeping",{value:!1,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"stop_keeping_total",{value:!1,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"spec_init_wait_interval",{value:null,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"seconds_timer_interval",{value:null,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"timer_seconds",{value:null,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"ms_left",{value:null,writable:!0,enumerable:!1,configurable:!0}),this.csec,Object.defineProperty(this,"is_mobile",{value:this.checkIfMobile(),writable:!0,enumerable:!1,configurable:!0}),this.bp,this.sleep_def,this.cssp,this.imgp;var o=this;Object.defineProperty(this,"startKeeping",{value:t,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"countSummSec",{value:i,writable:!0,enumerable:!1,configurable:!0})}return e.prototype.init=function(){function e(e,t,i){var o=l,c=JSON.parse(e);ck_debug&&console.log("init() afterFirstLoad(): Пришёл ответ с сервера, разбираем его: "+e),c[0].lt=(new Date).getTime();var a=o.setupSetting(c[0],c[1]);a?(o.setSrctCookie(o.srct),o.createPhoneButton(),o.sleep_def&&!o.cpt&&"def"==o.lpt&&(ck_debug&&console.log("init() afterFirstLoad(): Флаг Sleep on Default - "+o.sleep_def+" и загруженная фраза lpt - "+o.lpt+". И cpt пуста. Накидываю недостижимых баллов в .fas"),o.fas+=1e4,c[0].fas+=1e4),o.client_memory.setItem("callkeep_main",JSON.stringify(c[0])),o.client_memory.setItem("callkeep_act_cond",JSON.stringify(c[1])),ck_debug&&console.log("init() afterFirstLoad(): Все данные записались успешно, запускаем отслеживание..."),o.showPhoneButton(),o.spec_keeping?(ck_debug&&console.log("init() afterFirstLoad(): Отмечено спец отслеживание для данной страницы. Не запускаю startKeeping(). Данные сохранены. Состояние ставлю -> keeping"),o.client_memory.setItem("callkeep_cst","keeping")):o.startKeeping()):ck_debug&&console.log("init() afterFirstLoad(): ОШИБКА! - не удалось сделать установку параметров.")}if(this.summsec_interval=setInterval(this.countSummSec,1e3),this.client_memory.getItem("callkeep_cst"))this.defineState()&&this.start();else{ck_debug&&console.log("init() - КУК НЕТ - новый клиент!!!"),this.client_memory.setItem("callkeep_vers",this.version),this.clearScore();var t={};t[this.ck_id]=(new Date).getTime(),this.client_memory.setItem("callkeep_aw",JSON.stringify(t)),this.client_memory.setItem("callkeep_ep",document.location.pathname),this.client_memory.setItem("callkeep_ept",jQuery("title").text()),this.client_memory.setItem("callkeep_eph1",jQuery("h1").eq(0).text());var i=this.urlGetParams(),o="";i._openstat&&(this.client_memory.setItem("callkeep_os",i._openstat),o+="&ck_os="+i._openstat,ck_debug&&console.log("init() - в запросе есть _openstat = "+i._openstat+" - передаём помимо точки входа ещё и его в БД для определения фразы...")),i.utm_campaign&&(this.client_memory.setItem("callkeep_utmcamp",i.utm_campaign),o+="&ck_camp="+i.utm_campaign,ck_debug&&console.log("init() - в запросе есть utm_campaign = "+i.utm_campaign+" - передаём помимо точки входа ещё и его в БД для определения фразы...")),i.utm_source&&(this.client_memory.setItem("callkeep_utmsrc",i.utm_source),o+="&ck_utmsrc="+i.utm_source,ck_debug&&console.log("init() - в запросе есть utm_source = "+i.utm_source+" - передаём и его в БД пока без надобности...")),i.gclid&&(this.client_memory.setItem("callkeep_gclid",i.gclid),o+="&ck_gclid="+i.gclid,ck_debug&&console.log("init() - в запросе есть gclid = "+i.gclid+" - передаём и его в БД пока без надобности...")),this.defineReferrer(),this.client_memory.setItem("callkeep_rflc",this.ck_id),this.im_responsible=!0,this.im_only_one=!0,this.client_memory.setItem("callkeep_cst","init"),ck_debug&&console.log("init() Отправляю запрос для точки входа: "+location.pathname),jQuery.ajax({type:"POST",url:this.fc,data:"wid="+this.wid+"&op=load&ck_ep="+location.pathname+o+"&ep_url="+encodeURIComponent(location.href)+"&rfr_url="+encodeURIComponent(this.rfr),success:e})}var l=this},e.prototype.setSrctCookie=function(e){var t=new DialogWidget.CallKeepCookieHandler(2592e3,"/");t.setItem("dw_srct",e)},e.prototype.start=function(){function e(e,t,i){var o=a;ck_debug&&console.log("setParamsAndStartKeeping(): Пришёл ответ с сервера, разбираем его: "+e);var l=JSON.parse(e);l[0].lt=(new Date).getTime();var c=o.setupNewSettingsForEnterPoint(location.pathname,l);c&&(o.setSrctCookie(o.srct),o.sleep_def&&!o.cpt&&"def"==o.lpt&&(ck_debug&&console.log("init() setParamsAndStartKeeping(): Флаг Sleep on Default - "+o.sleep_def+" и загруженная фраза lpt - "+o.lpt+". И cpt пуста. Накидываю недостижимых баллов в .fas"),o.fas+=1e4,l[0].fas+=1e4),o.client_memory.setItem("callkeep_main",JSON.stringify(l[0])),o.client_memory.setItem("callkeep_act_cond",JSON.stringify(l[1])),o.startKeeping())}function t(e,t,i){var o=a;ck_debug&&console.log("setParamsAndWaitNextKeeping(): Пришёл ответ с сервера, разбираем: "+e);var l=JSON.parse(e);l[0].lt=(new Date).getTime();var n=o.setupNewSettingsForEnterPoint(location.pathname,l);n&&(o.setSrctCookie(o.srct),o.sleep_def&&!o.cpt&&"def"==o.lpt&&(ck_debug&&console.log("init() setParamsAndWaitNextKeeping(): Флаг Sleep on Default - "+o.sleep_def+" и загруженная фраза lpt - "+o.lpt+". И cpt пуста. Накидываю недостижимых баллов в .fas"),o.fas+=1e4,l[0].fas+=1e4),o.client_memory.setItem("callkeep_main",JSON.stringify(l[0])),o.client_memory.setItem("callkeep_act_cond",JSON.stringify(l[1])),o.start_keeping_timer=setTimeout(o.startKeeping,c),o.waitAndBeActive())}if(ck_debug&&console.log("start():  Приложение запущено. Статус: "+this.client_memory.getItem("callkeep_cst")),0==this.act_cond.length)return void console.log("start(): ОШИБКА! - нет условий. Ничего не запускаю...");this.createPhoneButton();var i=this.urlGetParams(),o="";switch(i._openstat&&(o+="&ck_os="+i._openstat,ck_debug&&console.log("start() - есть _openstat = "+i._openstat+" - готовим его для передачи в БД, если надо")),i.utm_campaign&&(o+="&ck_camp="+i.utm_campaign,ck_debug&&console.log("init() - в запросе есть utm_campaign = "+i.utm_campaign+" - готовим его для передачи в БД, если надо")),this.showPhoneButton(),this.client_memory.getItem("callkeep_cst")){case"keeping":if(ck_debug&&console.log("start(): callkeep_cst -> keeping"),this.im_only_one){var l=(new Date).getTime()-this.last_presence_time;l/1e3/60/60>24?(ck_debug&&console.log("start(): callkeep_cst -> keeping - скрипт одинок. С прошлой сессии остался статус keeping, и прошло больше 24 часов: "+l/1e3/60/60+". Считаем эту сессию новой. Делаю запрос к БД и запускаю отслеживание."),i._openstat?this.client_memory.setItem("callkeep_os",i._openstat):this.client_memory.removeItem("callkeep_os"),jQuery.ajax({type:"POST",url:this.fc,data:"wid="+this.wid+"&op=load&ck_ep="+location.pathname+o+"&ep_url="+encodeURIComponent(location.href)+"&rfr_url="+encodeURIComponent(this.rfr),success:e})):(ck_debug&&console.log("start(): callkeep_cst -> keeping - скрипт одинок. С прошлой сессии остался статус keeping, и ещё не прошли сутки: "+l/1e3/60/60+". Считаем эту сессию действующей и запускаю отслеживание."),this.startKeeping())}else ck_debug&&console.log("start(): callkeep_cst -> keeping - скрипт не одинок."),this.startKeeping();break;case"form_was_activated":if(ck_debug&&console.log("start(): callkeep_cst -> form_was_activated"),this.im_only_one){this.client_memory.setItem("callkeep_cst","form_was_closed"),this.client_memory.setItem("callkeep_lct",this.last_presence_time),ck_debug&&console.log("start(): form_was_activated -> СКРИПТ ОДИНОК, переводим form_was_activated -> form_was_closed");var c=this.last_presence_time+1e3*this.rat-(new Date).getTime();0>=c?(ck_debug&&console.log("start(): form_was_activated->form_was_closed - уже пора запускать новое отслеживание. Загружаю настройки из БД и Запускаю отслеживание..."),i._openstat?this.client_memory.setItem("callkeep_os",i._openstat):this.client_memory.removeItem("callkeep_os"),jQuery.ajax({type:"POST",url:this.fc,data:"wid="+this.wid+"&op=load&ck_ep="+location.pathname+o+"&ep_url="+encodeURIComponent(location.href)+"&rfr_url="+encodeURIComponent(this.rfr),success:e})):(ck_debug&&console.log("start(): form_was_activated->form_was_closed - Ещё рано запускать новое отслеживание. Таймер на запуск через "+c/1e3+" секунд."),this.start_keeping_timer=setTimeout(this.startKeeping,c),this.waitAndBeActive())}else ck_debug&&console.log("start(): form_was_activated -> скрипт не одинок, показываем форму и ждём реакции пользователя"),this.showPopup(),this.waitOpenedForm();break;case"form_was_closed":ck_debug&&console.log("start(): form_was_closed -- Смотрим пора ли запускать скрипт...");var c=parseInt(this.client_memory.getItem("callkeep_lct"))+1e3*this.rat-(new Date).getTime();ck_debug&&console.log("start(): form_was_closed -- ждать ещё "+c/1e3+" секунд"),0>=c?(ck_debug&&console.log("start(): form_was_closed -- Время активации уже подошло. Загружаю настройки из БД и запускаю отслеживание...."),i._openstat?this.client_memory.setItem("callkeep_os",i._openstat):this.client_memory.removeItem("callkeep_os"),jQuery.ajax({type:"POST",url:this.fc,data:"wid="+this.wid+"&op=load&ck_ep="+location.pathname+o+"&ep_url="+encodeURIComponent(location.href)+"&rfr_url="+encodeURIComponent(this.rfr),success:e})):(ck_debug&&console.log("start(): form_was_closed -- Запускать отслеживание ещё рано. Ставлю таймер на запуск через "+c/1e3+" секунд."),this.start_keeping_timer=setTimeout(this.startKeeping,c),this.waitAndBeActive());break;case"form_was_submitted":ck_debug&&console.log("start(): form_was_submitted -- Смотрим сколько времени осталось до запуска скрипта...");var c=parseInt(this.client_memory.getItem("callkeep_lst"))+1e3*this.raast-(new Date).getTime();0>=c?(ck_debug&&console.log("start(): form_was_submitted -- Время активации после сабмита уже подошло. Загружаю настройки из БД и запускаю отслеживание...."),i._openstat?this.client_memory.setItem("callkeep_os",i._openstat):this.client_memory.removeItem("callkeep_os"),jQuery.ajax({type:"POST",url:this.fc,data:"wid="+this.wid+"&op=load&ck_ep="+location.pathname+o+"&ep_url="+encodeURIComponent(location.href)+"&rfr_url="+encodeURIComponent(this.rfr),success:e})):600>c/1e3?(ck_debug&&console.log("start(): form_was_submitted -- До запуска отслеживания осталось меньше 10 минут: "+c/1e3/60+". Загружаю настройки из БД и ставлю таймер на начало отслеживания..."),i._openstat?this.client_memory.setItem("callkeep_os",i._openstat):this.client_memory.removeItem("callkeep_os"),jQuery.ajax({type:"POST",url:this.fc,data:"wid="+this.wid+"&op=load&ck_ep="+location.pathname+o+"&ep_url="+encodeURIComponent(location.href)+"&rfr_url="+encodeURIComponent(this.rfr),success:t})):(this.hidePhoneButton(),ck_debug&&console.log("start(): form_was_submitted -- До запуска скрипта ещё долго: "+parseInt(c/1e3/60)+" минут. Ничего не делаю."))}var a=this},e.prototype.setupNewSettingsForEnterPoint=function(e,t){var i=this.setupSetting(t[0],t[1]);return i?(this.client_memory.setItem("callkeep_ep",e),this.client_memory.setItem("callkeep_ept",jQuery("title").text()),this.client_memory.setItem("callkeep_eph1",jQuery("h1").eq(0).text()),ck_debug&&console.log("Новые настройки для точки входа "+e+" установлены.")):ck_debug&&console.log("ОШИБКА! - Новые настройки для точки входа "+e+" НЕ установлены. В массиве из БД не все свойства преобразовываются в true."),i},e.prototype.defineState=function(){if(ck_debug&&console.log("defineState(): - КУКи ЕСТЬ считываем настройки и отмечаемся"),this.client_memory.getItem("callkeep_vers")!=this.version)return console.log("DialogWidget: версия скрипта не найдена или обновлена, делаю перезапуск..."),this.client_memory.clear(),this.second_load=!0,this.init(),!1;var e=JSON.parse(this.client_memory.getItem("callkeep_main")),t=JSON.parse(this.client_memory.getItem("callkeep_act_cond"));if(!this.setupSetting(e,t))return console.log("DialogWidget: Ошибка при попытке считать данные у клиента (defineState()). Делаю перезапуск..."),this.client_memory.clear(),this.second_load=!0,this.init(),!1;var i=JSON.parse(this.client_memory.getItem("callkeep_aw"));i[this.ck_id]=(new Date).getTime(),this.client_memory.setItem("callkeep_aw",JSON.stringify(i)),this.imActive();var o=parseInt(this.client_memory.getItem("callkeep_cs"));return(0>o||isNaN(o))&&(this.client_memory.setItem("callkeep_cs","0"),ck_debug&&console.log("defineState(): - КУКи ЕСТЬ: текущий счёт - не положительное число -> устанавливаем на 0 -> "+this.client_memory.getItem("callkeep_cs"))),this.rfr=this.client_memory.getItem("callkeep_rfr"),!0},e.prototype.setupSetting=function(e,t){var i=!0;if(!(e&&e.fas&&e.rat&&e.raast))return!1;if(!e.wtp&&!this.whacp)return ck_debug&&console.log("setupSetting() - не передана фраза. Данные не будут установлены. Виджет не запустится. Состояние: "+this.client_memory.getItem("callkeep_cst")),"init"==this.client_memory.getItem("callkeep_cst")&&ck_clear(),this.empty_phrase=!0,!1;if(this.wtp=e.wtp,this.nwtp=e.nwtp,this.wth=e.wth,this.nwth=e.nwth,this.lhint=e.hint||jQuery("h1").eq(0).text(),this.lpt=e.cpt,this.sbe=e.sbe,this.sbs=e.sbs,this.lt=e.lt,this.fas=e.fas,this.bp=e.bp,this.rat=e.rat,this.raast=e.raast,this.csec=e.csec,this.sleep_def=e.sleep,this.ya_c=e.ya_c,this.srct=e.srct,this.srcs=e.srcs,this.cssp=e.cssp,this.imgp=e.imgp,!t)return!1;for(var o=0,l=t.length;l>o;o++){var c=DialogWidget.ActionCondition.prototype.createConditionObject(t[o].vn,t[o].av,t[o].asc,this);c.vn&&c.av&&c.asc||(i=!1),c&&this.act_cond.push(c)}return this.activateUserForms(),jQuery("#dw_styles").is("link")?jQuery("#dw_styles").attr("href",this.dp+this.cssp+"dialogwidget.css"):jQuery("head").append('<link rel="stylesheet" type="text/css" href="'+this.dp+this.cssp+'dialogwidget.css" id="dw_styles" />'),i},e.prototype.urlGetParams=function(){var e=window.location.search,t=[],o=[],l={};if(t=e.substr(1).split("&"),""==t[0])return!1;for(i=0;i<t.length;i++)o=t[i].split("="),l[o[0]]=o[1];return l},e.prototype.stopKeeping=function(e){e&&(this.stop_keeping_total=!0),clearInterval(this.keeping_interval);for(var t=0,i=this.act_cond.length;i>t;t++)this.act_cond[t]&&this.act_cond[t].stopWatching();this.keeping_interval=null,ck_debug&&console.log("stopKeeping(): Отслеживание по всем условиям остановлено. keeping_interval ->null")},e.prototype.waitOpenedForm=function(){function e(){var e=t;e.imActive();var i=e.client_memory.getItem("callkeep_cst");switch(i){case"form_was_closed":ck_debug&&console.log("waitingOpenedFormFunction(): Текущее состояние формы изменилось на form_was_closed прекращаем ожидание, скрываем форму, УСТАНАВЛИВАЕМ ТАЙМЕР запуска формы через "+e.rat+" секунд"),e.hidePopup(),e.start_keeping_timer=setTimeout(e.startKeeping,1e3*e.rat),e.waitAndBeActive(),clearInterval(e.waiting_interval),e.showPhoneButton();break;case"form_was_submitted":ck_debug&&console.log("waitingOpenedFormFunction(): Текущее состояние формы изменилось на form_was_submitted прекращаем ожидание"),e.i_acted||(ck_debug&&console.log("waitingOpenedFormFunction(): форма была отправлена в другом окне. Скрываем нашу.."),e.hidePopup()),clearInterval(e.waiting_interval);break;case"keeping":ck_debug&&console.log("waitingOpenedFormFunction(): Текущее состояние формы изменилось на keeping - прячу форму и начинаю отслеживание."),e.hidePopup(),e.startKeeping(),clearInterval(e.waiting_interval);break;case"error":ck_debug&&console.log("waitingOpenedFormFunction(): Текущее состояние формы изменилось на error - ничего не делаем"),e.hidePopup(),clearInterval(e.waiting_interval)}ck_debug_periods&&console.log("waitingOpenedFormFunction(): - "+e.client_memory.getItem("callkeep_aw")+"      ГЛАВНЫЙ-> "+e.client_memory.getItem("callkeep_rflc")+"       Я ГЛАВНЫЙ ->"+e.im_responsible+"        я один ->"+e.im_only_one+"       мой id -> "+e.ck_id)}var t=this;ck_debug&&console.log("Начинаю отслеживать открытую форму..."),this.waiting_interval=setInterval(e,1e3)},e.prototype.waitAndBeActive=function(){function e(){var e=t;e.imActive(),("keeping"==e.client_memory.getItem("callkeep_cst")||"error"==e.client_memory.getItem("callkeep_cst"))&&(clearTimeout(e.start_keeping_timer),e.startKeeping(),ck_debug&&console.log("waitAndBeActive(): Состояние изменилось на Keeping. Очищаю таймер на запуск отслеживания и начинаю отслеживание."),clearInterval(e.waiting_active_interval)),"form_was_activated"==e.client_memory.getItem("callkeep_cst")&&(e.popup_is_shown?ck_debug&&console.log("waitAndBeActive(): Прямой вызов окна... Стираю таймер запуска отслеживания, waiting_active_interval и начинаю отслеживание открытой формы."):(ck_debug&&console.log("waitAndBeActive(): в другой вкладке была нажата кнопка. Показываю форму, стираю таймер запуска отслеживания, waiting_active_interval и начинаю отслеживание открытой формы."),e.showPopup()),clearTimeout(e.start_keeping_timer),clearInterval(e.waiting_active_interval),e.waitOpenedForm()),ck_debug_periods&&console.log("waitAndBeActive(): - "+e.client_memory.getItem("callkeep_aw")+"      ГЛАВНЫЙ-> "+e.client_memory.getItem("callkeep_rflc")+"       Я ГЛАВНЫЙ ->"+e.im_responsible+"        я один ->"+e.im_only_one+"       мой id -> "+e.ck_id)}var t=this;this.waiting_active_interval=setInterval(e,1e3)},e.prototype.createPhoneButton=function(){function e(e){var i=c.scrollTop()-a,o=parseInt(l.css("bottom"));l.css("bottom",o+i+"px"),0==n&&(n=setTimeout(t,500)),a=c.scrollTop()}function t(){l.css("bottom",""),n=0}function i(){var e=s;return ck_debug&&console.log("buttonAct() - кнопка нажата. Останавливаю отслеживание, waiting_active_interval и удаляю таймер запуска keeping."),e.activatePopup(),e.stopKeeping(),e.client_memory.setItem("callkeep_cs","0"),clearTimeout(e.start_keeping_timer),clearInterval(e.waiting_active_interval),e.waitOpenedForm(),e.hidePhoneButton(),!1}var o;o=this.is_mobile?'<a href="#" id="ck_phone_a" class="ck-phone-link ck-phone-link-hidden ck-phone-link-mobile ck-phone-link-mobile-'+this.bp+'"><img src="'+this.dp+this.imgp+"ck_phone_mob_"+this.bp+'.png"></a>':'<a href="#" id="ck_phone_a" class="ck-phone-link ck-phone-link-hidden"><img src="'+this.dp+this.imgp+'ck_phone.png"></a>',jQuery("body").append(o);var l=jQuery("#ck_phone_a"),c=jQuery(window),a=c.scrollTop(),n=0;this.is_mobile||c.scroll(e),l.click(i);var s=this},e.prototype.showPhoneButton=function(){return this.empty_phrase?void(ck_debug&&console.log("- showPhoneButton() - у скрипта нет фразы для показа. не отображаю кнопку...")):(jQuery("a#ck_phone_a").removeClass("ck-phone-link-hidden"),void(jQuery("a#ck_phone_a").attr("title")||jQuery("a#ck_phone_a").attr("title",this.cp)))},e.prototype.hidePhoneButton=function(){jQuery("a#ck_phone_a").addClass("ck-phone-link-hidden")},e.prototype.createPopup=function(){function e(e){function i(e){e?(jQuery("input#ck_phone_submit").removeAttr("disabled"),jQuery("#callkeep_timer").removeClass("ck-timer-inactive").addClass("ck-timer-preactive")):(jQuery("input#ck_phone_submit").attr("disabled","disabled"),jQuery("#callkeep_timer").removeClass("ck-timer-preactive").addClass("ck-timer-inactive"))}function o(e){function t(e,t,l){function c(){if(o.ms_left>=90){if(0==o.timer_seconds)return o.timer_seconds=0,s.html("Благодарим за ожидание!<br>Менеджер перезвонил Вам?"),r.text("00"),_.text("00"),jQuery("#callkeep_timer").hide(),jQuery("#ck_aftercall_form").show(),ck_debug&&console.log("Сабмит формы: Таймер закончил отсчёт показываю кнопки."),clearInterval(o.seconds_timer_interval),delete o.seconds_timer_interval,void jQuery("a#ck_close_box_a").unbind("click").click(function(e){return a.hidePopup(),jQuery("#ck_aftercall_form").hide(),!1});o.timer_seconds--,r.text(o.timer_seconds>=10?o.timer_seconds:"0"+o.timer_seconds),o.ms_left=-10,p.toggleClass("ck-timer-dots-hidden")}40==o.ms_left&&p.toggleClass("ck-timer-dots-hidden"),o.ms_left+=10,_.text(o.ms_left>0?100-o.ms_left+Math.floor(10*Math.random()-1):"00")}var n=JSON.parse(e);jQuery("#ck_aftercall_lid_hid").val(n.lid),jQuery("#ck_aftercall_phone_hid").val(jQuery("#ck_phone_input").val());var s=jQuery("div#ck_phrase");if(ck_debug&&console.log("Сабмит формы: Получен ответ: "),ck_debug&&console.log(n),jQuery("img#ck_loading_icon").hide(),s.text(n.text).show(),"error"==n.status)return ck_debug&&console.log("Сабмит формы: Статус ответа - ошибка"),"phone"==n.errorcode&&(ck_debug&&console.log("Сабмит формы: ОШИБКА не верно введён телефон! Устанавливаю состояние form_was_activated и показываю форму."),jQuery("input#ck_phone_input").val(""),i(!1),o.displayTimer(),jQuery("form#callkeep_form").show(),o.client_memory.setItem("callkeep_cst","form_was_activated"),jQuery("a#ck_close_box_a").unbind("click").click(function(e){return o.closePopup(),o.showPhoneButton(),!1})),void("spam_block"==n.errorcode&&(ck_debug&&console.log("Сабмит формы: ОШИБКА превышен лимит заявок. Показываю уведомление и ничего не делаю."),jQuery("input#ck_phone_input").val(""),i(!1)));if("function"==typeof ga&&ga("send","event","DialogWidget","DialogWidget Submit"),"object"==typeof _gaq&&"function"==typeof _gaq.push&&_gaq.push(["_trackEvent","DialogWidget","DialogWidget Submit"]),o.ya_c&&window["yaCounter"+o.ya_c].reachGoal("DialogWidget_Submit"),"function"==typeof DialogWidgetSubmit?(ck_debug&&console.log("Сабмит формы: DialogWidgetSubmit запуск функции"),DialogWidgetSubmit()):ck_debug&&console.log("Сабмит формы: DialogWidgetSubmit функция не найдена"),n.wh&&"spam_call"!=n.errorcode){ck_debug&&console.log("Сабмит формы: Время рабочее - запускаю таймер..."),jQuery("#callkeep_timer").show(),jQuery("#ck_aftercall_form_box").show(),o.timer_seconds=o.csec,o.ms_left=100;var r=jQuery("#ck_timer_seconds"),_=jQuery("#ck_timer_milliseconds"),p=jQuery("#ck_timer_dots");o.seconds_timer_interval=setInterval(c,100)}else ck_debug&&("spam_call"==n.errorcode?console.log("Сабмит формы: Заявка с блокировкой звонка. Показываю благодарность."):console.log("Сабмит формы: Время не рабочее показываю благодарность.")),s.addClass("ck-response"),i(!0),jQuery("a#ck_close_box_a, div#ck_overlay").on("click",function(e){return s.removeClass("ck-response"),!1})}if(e.preventDefault(),!jQuery("input#ck_phone_input").val())return ck_debug&&console.log("ОШИБКА - Сабмит формы: поле телефона не заполнено. Прерываю обработку сабмита."),jQuery("input#ck_phone_input").attr("placeholder","введите телефон..."),!1;var o=a;o.i_acted=!0,ck_debug&&console.log("Сабмит формы: скрываю форму и фразу..."),jQuery("form#callkeep_form").hide(),jQuery("div#ck_phrase").hide(),jQuery("img#ck_loading_icon").show(),jQuery("#callkeep_timer").removeClass("ck-timer-preactive").hide(),ck_debug&&console.log("Сабмит формы: Устанавливаю состояние в form_was_submitted и фиксирую время..."),o.client_memory.setItem("callkeep_cst","form_was_submitted"),o.client_memory.setItem("callkeep_lst",(new Date).getTime());var l=parseInt(o.client_memory.getItem("callkeep_ts"));"number"!=typeof l||isNaN(l)?(o.client_memory.setItem("callkeep_ts",1),ck_debug&&console.log("Сабмит формы: Количество отправленных заявок не определилось ставлю 1")):(o.client_memory.setItem("callkeep_ts",l+1),ck_debug&&console.log("Сабмит формы: Эта заявка отправлена по счёту: "+(l+1))),jQuery("a#ck_close_box_a").unbind("click").text("закрыть"),jQuery("div#ck_overlay").unbind("click"),jQuery("a#ck_close_box_a").click(function(e){return o.hidePopup(),o.seconds_timer_interval&&(clearInterval(o.seconds_timer_interval),jQuery("#ck_timer_seconds").text(o.csec),jQuery("#ck_timer_milliseconds").text("00")),!1}),ck_debug&&console.log("Сабмит формы: Делаю запрос...");var c=jQuery(this).serialize();jQuery.ajax({type:"POST",url:o.fc,data:c,success:t})}function l(e){ck_debug&&console.log("Ответ клиента: ДА. Скрываю форму и отправляю запрос на подтверждение заявки."),e.preventDefault(),a.hidePopup(),jQuery("#ck_aftercall_answer_hid").val("yes"),jQuery("#ck_aftercall_form").hide();var t=jQuery("form#ck_aftercall_form").serialize();return jQuery.ajax({type:"POST",url:a.fc,data:t}),!1}function c(e){ck_debug&&console.log("Ответ клиента: НЕТ. Скрываю форму, показываю уведомление и отправляю запрос на подтверждение заявки."),e.preventDefault(),jQuery("#ck_aftercall_form").hide(),jQuery("#ck_aftercall_form_box").hide(),jQuery("div#ck_phrase").html("Уведомление отправлено.<br><br>Приносим извинения за неудобства. Похоже, что все менеджеры были заняты. Мы свяжемся с вами в ближайшее время.").css("height","auto"),jQuery("#ck_aftercall_answer_hid").val("no"),jQuery("div#ck_overlay").click(function(e){"ck_overlay"==e.target.id&&a.hidePopup()});var t=jQuery("form#ck_aftercall_form").serialize();return jQuery.ajax({type:"POST",url:a.fc,data:t}),!1}var a=t;a.is_mobile&&jQuery("div#ck_box").addClass("ck-mobile-box"),jQuery(this).toggleClass("ck-overlay-blur-flag").show(),a.setPhrase(a.cp,a.cpt,a.ch),a.setHint(a.chint),jQuery("a#ck_close_box_a").click(function(e){return a.closePopup(),a.showPhoneButton(),!1}),
jQuery("div#ck_overlay").click(function(e){"ck_overlay"==e.target.id&&(a.closePopup(),a.showPhoneButton())}),jQuery("div#ck_box").css("top","50%"),jQuery("input#ck_ep_hid").val(a.client_memory.getItem("callkeep_ep")),jQuery("input#ck_ep_title_hid").val(a.client_memory.getItem("callkeep_ept")),jQuery("input#ck_actp_hid").val(window.location.pathname),jQuery("input#ck_actp_title_hid").val(jQuery("title").text()),a.client_memory.getItem("callkeep_os")&&jQuery("input#ck_openstat_hid").val(a.client_memory.getItem("callkeep_os")),a.client_memory.getItem("callkeep_utmcamp")&&jQuery("input#ck_camp_hid").val(a.client_memory.getItem("callkeep_utmcamp")),a.client_memory.getItem("callkeep_utmsrc")&&jQuery("input#utm_src_hid").val(a.client_memory.getItem("callkeep_utmsrc")),a.client_memory.getItem("callkeep_gclid")&&jQuery("input#gclid_hid").val(a.client_memory.getItem("callkeep_gclid")),jQuery("input#source_hid").val(a.rfr),jQuery("#ck_aftercall_timer").data("recallsec",a.csec),jQuery("#ck_timer_seconds").text(a.csec>=10?a.csec:"0"+a.csec),jQuery("input.dw-wid-hid").val(a.wid),jQuery("img.ck-form-image").each(function(){jQuery(this).attr("src",a.dp+a.imgp+jQuery(this).attr("src"))}),"function"!=typeof jQuery("input#ck_phone_input").mask?(ck_debug&&console.log("createPopup(): Функция .mask - не функция :) Наверно плагин Masked Input не установлен. Подключаю плагин от себя..."),jQuery.getScript(a.dp+"/jquery.maskedinput.js",function(e){jQuery("input#ck_phone_input").mask("9 (999) 999-99-99",{placeholder:"_"})})):jQuery("input#ck_phone_input").mask("9 (999) 999-99-99",{placeholder:"_"}),jQuery("input#ck_phone_input").keyup(function(e){var t=jQuery(this).val().replace(/\D/g,"");i(11!=t.length?!1:!0)}),jQuery("#ck_autor_link").on("click",function(e){var t="//dialogwidget.ru/widget.php",i="?tr=";i+=a.srct?a.srct.substring(0,1)+"*":"*",i+=a.srcs?a.srcs+"*":"*",i+=a.summsec?a.summsec+"*":"*";var o=a.client_memory.getItem("callkeep_eph1");o&&(i+=encodeURIComponent(o.replace("*"," "))),jQuery(this).attr("href",t+i),setTimeout(function(){jQuery("#ck_autor_link").attr("href","//dialogwidget.ru/")},1e3)}),jQuery("#callkeep_form").on("submit",o),jQuery("#ck_aftercall_yes").click(l),jQuery("#ck_aftercall_no").click(c)}ck_debug&&console.log("- DW.prototype.createPopup - вставляем в HTML старницы окно и кнопку DW...");var t=this;jQuery("body").prepend('<div id="ck_overlay" style="display:none;"><div>'),jQuery("div#ck_overlay").load(this.fc,{wid:this.wid,op:"popup"},e)},e.prototype.closePopup=function(){this.hidePopup(),this.client_memory.setItem("callkeep_cst","form_was_closed"),this.client_memory.setItem("callkeep_lct",(new Date).getTime()),ck_debug&&console.log("closePopup(): форма закрыта с записью состояния")},e.prototype.hidePopup=function(){"function"==typeof ga&&ga("send","event","DialogWidget","DialogWidget Closed"),jQuery("div#ck_overlay").removeClass("ck-overlay-blur-flag").hide(),this.popup_is_shown=!1,ck_debug&&console.log("hidePopup(): форма скрыта без записи состояния")},e.prototype.showPopup=function(e,t,i,o,l){return this.popup_is_shown?void(ck_debug&&console.log("showPopup(): Окно с формой уже показано. Ничего не делаю.")):(this.popup_is_shown=!0,this.hidePhoneButton(),e&&t?(this.cpt="once",ck_debug&&console.log("showPopup(): Переданы 2 аргумента - прямой вызов окна - тип фразы - once"),this.cp=this.currPhrase(e,t),this.chint=i,this.ch=o&&l?this.currHeading(o,l):o):e?(this.cp=e,this.cpt="once",ck_debug&&console.log("showPopup(): Передан 1 аргумент - прямой вызов окна - тип фразы - once"),this.chint=i,this.ch=o&&l?this.currHeading(o,l):o):this.whacp&&this.nwhacp?(ck_debug&&console.log("showPopup(): Есть 2 альтернативные фразы - тип фразы - "+this.cpt),this.cp=this.currPhrase(this.whacp,this.nwhacp),this.chint=this.ahint,this.ch=this.wtah&&this.nwtah?this.currHeading(this.wtah,this.nwtah):this.wtah):this.whacp?(ck_debug&&console.log("showPopup(): Есть 1 альтернативная фраза - тип фразы - "+this.cpt),this.cp=this.whacp,this.chint=this.ahint,this.ch=this.wtah&&this.nwtah?this.currHeading(this.wtah,this.nwtah):this.wtah):(this.cpt=this.lpt,ck_debug&&console.log("showPopup(): Обычный режим выбираем из 2 фраз из БД. тип - "+this.cpt),this.cp=this.currPhrase(),this.chint=this.lhint,this.ch=this.currHeading()),jQuery("div#ck_overlay").is("div")?(ck_debug&&console.log("showPopup(): форма уже существует, просто показываем её..."),jQuery("div#ck_overlay").addClass("ck-overlay-blur-flag").show(),this.setPhrase(this.cp,this.cpt,this.ch),this.setHint(this.chint),this.displayTimer()):this.createPopup(),"function"==typeof ga&&ga("send","event","DialogWidget","DialogWidget Opened"),void("function"==typeof DialogWidgetWindowOpen?(ck_debug&&console.log("Открытие формы: DialogWidgetWindowOpen запуск функции"),DialogWidgetWindowOpen()):ck_debug&&console.log("Открытие формы: DialogWidgetWindowOpen функция не найдена")))},e.prototype.activatePopup=function(e,t,i,o,l){this.client_memory.setItem("callkeep_cst","form_was_activated"),this.client_memory.setItem("callkeep_lat",(new Date).getTime()),e?this.showPopup(e,t,i,o,l):this.showPopup(),ck_debug&&console.log("activatePopup() - форма активирована с записью состояния и времени активации.")},e.prototype.displayTimer=function(){this.popup_is_shown&&(this.checkWh()?(jQuery("span#ck_timer_seconds").text(this.csec),jQuery("form#callkeep_form").removeClass("unwh").show(),jQuery("div#callkeep_timer").removeClass("unwh").show(),ck_debug&&console.log("displayTimer(): форма показана в рабочее время, показываю таймер...")):(jQuery("form#callkeep_form").addClass("unwh"),jQuery("div#callkeep_timer").addClass("unwh").hide(),ck_debug&&console.log("displayTimer(): форма показана в НЕ рабочее время, скрываю таймер...")))},e.prototype.imActive=function(){var e=0,t=0,i=this.client_memory.getItem("callkeep_rflc"),o=JSON.parse(this.client_memory.getItem("callkeep_aw"));o[this.ck_id]=(new Date).getTime();for(var l in o)(new Date).getTime()-o[l]>1005?(o[l]>t&&(t=o[l]),delete o[l],ck_debug&&console.log("imActive -> "+l+" просрочен. Удаляем его.")):e++;this.client_memory.setItem("callkeep_aw",JSON.stringify(o)),o[i]||(ck_debug&&console.log("imActive -> ответственный "+i+" пропал. Я за него! -> "+this.ck_id),this.client_memory.setItem("callkeep_rflc",this.ck_id),this.im_responsible=!0),e>1?this.im_only_one=!1:this.im_only_one=!0,t&&!this.last_presence_time&&this.im_only_one&&(this.last_presence_time=t,ck_debug&&console.log("imActive -> установлено время последнего присутствия на сайте с прошлой сессии: "+t)),o=JSON.parse(this.client_memory.getItem("callkeep_aw")),i=this.client_memory.getItem("callkeep_rflc"),o[i]&&this.ck_id!=i&&(this.im_responsible=!1)},e.prototype.checkWh=function(){var e=((new Date).getTime()-this.lt)/1e3;return null!==this.sbe?e>this.sbe?(ck_debug&&console.log("checkWh() - проверка рабочего времени: фраза была загружена в рабочее время, но рабочее время подошло к концу. Сейчас НЕ РАБОЧЕЕ ВРЕМЯ."),!1):(ck_debug&&console.log("checkWh() - проверка рабочего времени: фраза была загружена в рабочее время, сейчас всё ещё РАБОЧЕЕ ВРЕМЯ."),!0):null!==this.sbs?e>this.sbs?(ck_debug&&console.log("checkWh() - проверка рабочего времени: фраза была загружена в не рабочее время, но рабочее время уже началось. Сейчас РАБОЧЕЕ ВРЕМЯ."),!0):(ck_debug&&console.log("checkWh() - проверка рабочего времени: фраза была загружена в не рабочее время, Сейчас всё ещё НЕ РАБОЧЕЕ ВРЕМЯ. sbs = "+this.sbs+", со времени загрузки прошло "+e),!1):void 0},e.prototype.clearScore=function(){this.client_memory.setItem("callkeep_cs","0"),ck_debug&&console.log("clearScore() - счёт установлен на 0")},e.prototype.currPhrase=function(e,t){var i=this.checkWh();return e||t?e&&t?(ck_debug&&console.log("currPhrase() - выбрана фраза из переданных вручную"),i?e:t):(console.log("currPhrase() - Ошибка! Эта Ф-я принимает только 0 или 2 аргумента"),!1):(ck_debug&&console.log("currPhrase() - выбрана фраза из БД"),i?this.wtp:this.nwtp)},e.prototype.currHeading=function(e,t){var i=this.checkWh();return e||t?e&&t?(ck_debug&&console.log("currHeading() - выбраем заголовок из переданных"),i?e:t):(console.log("currHeading() - Ошибка! Эта Ф-я принимает только 0 или 2 аргумента"),!1):(ck_debug&&console.log("currHeading() - выбраем заголовок из БД"),i?this.wth:this.nwth)},e.prototype.setPhrase=function(e,t,i){if(e){var o=new RegExp(" за.*?секунд"),l=e.match(o),c=!1;l&&(c=e.replace(o,' <span id="ck_phrase_time">за '+this.csec+" секунд</span>")),c||(c=e),i?(jQuery("#ck_box").addClass("dw-box-with-heading"),c='<span id="dw_phrase_heading">'+i+"</span> "+c):jQuery("#ck_box").removeClass("dw-box-with-heading"),jQuery("div#ck_overlay").is("div")&&(jQuery("div#ck_phrase").html(c),jQuery("input#ck_act_phrase_hid").val((i||" ")+" "+e),jQuery("input#ck_phr_type_hid").val(t)),ck_debug&&console.log("setPhrase() - установлены: заголовок - "+i+" фраза - "+e)}else ck_debug&&console.log("setPhrase() - пустая фраза!")},e.prototype.setHint=function(e){return e?(ck_debug&&console.log("setHint() - устанавливаю подсказку для менеджера: "+e),void jQuery("input#ck_hint_hid").val(e)):(ck_debug&&console.log("setHint() - передана недействительная подсказка менеджеру - устанавливаю пустую"),void jQuery("input#ck_hint_hid").val(""))},e.prototype.setPagePhrase=function(e,t,i,o,l){return e||t?(ck_debug&&console.log("setPagePhrase() - Сохраняю альтернативные фразы: whacp - "+e+" --- nwhacp: "+t+" --- ahint: "+i),this.whacp=e,this.nwhacp=t,this.ahint=i,this.wtah=o,this.nwtah=l,void(this.cpt="page")):(ck_debug&&console.log("setPagePhrase() - принимает только 1 или 2 аргумента альтернативная фраза не установлена!"),!1)},e.prototype.specialKeeping=function(e,t,i,o,l){function c(){var e=a;"keeping"==e.client_memory.getItem("callkeep_cst")&&(e.stop_keeping_total?ck_debug&&console.log("specialKeeping()->spec_init_wait() был применён полный стоп keeping. ничего не запускаю."):e.startKeeping(),clearInterval(e.spec_init_wait_interval))}if(!e&&!t)return void console.log("specialKeeping() - ОШИБКА! ф-я принимает только 1 или 2 аргумента. Сейчас оба недействительны. Специальный режим не запущен.");switch(ck_debug&&console.log("specialKeeping() - специальный режим для данной страницы... текущее состояние:"+this.client_memory.getItem("callkeep_cst")),this.spec_keeping=!0,this.setPagePhrase(e,t,i,o,l),this.cpt="spec",this.client_memory.getItem("callkeep_cst")){case"keeping":ck_debug&&console.log("specialKeeping() - текущее состояние - keeping. сбрасываю счёт и начинаю отслеживание..."),this.clearScore(),this.startKeeping();break;case"form_was_closed":ck_debug&&console.log("specialKeeping() - текущее состояние - form_was_closed. Очищаю WaitAndBeActive и таймер startKeeping..."),clearTimeout(this.start_keeping_timer),clearInterval(this.waiting_active_interval),this.startKeeping();break;case"form_was_activated":ck_debug&&console.log("specialKeeping() - текущее состояние - form_was_activated. Форма открыта и есть другие окна. Закрываю форму и начинаю новое отслеживание..."),this.closePopup(),this.startKeeping();break;case"init":this.spec_init_wait_interval=setInterval(c,500)}var a=this},e.prototype.defineClientStorage=function(){var e=new DialogWidget.CallKeepCookieHandler(86400,"/");if(e.getItem("callkeep_cst"))return ck_debug&&console.log("defineClientStorage() - Куки уже использовались. Данные будут сохраняться в них. Срок - сутки"),e;if(delete e,window.localStorage){ck_debug&&console.log("localStorage присутствует. Проверяем доступность и сохраняем данные в него если доступен.");var t;try{t=new DialogWidget.CallKeepLocalStorageHandler}catch(i){ck_debug&&console.log("localStorage заблокирован. Будут использоваться Cookie"),t=new DialogWidget.CallKeepCookieHandler(2592e3,"/")}return t}return ck_debug&&console.log("localStorage НЕ ПОДДЕРЖИВАЕТСЯ! Данные будут сохраняться в КУКАХ..."),new DialogWidget.CallKeepCookieHandler(2592e3,"/")},e.prototype.checkIfMobile=function(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),ck_debug&&console.log("checkIfMobile() мобильность - "+e),e},e.prototype.defineReferrer=function(){this.rfr=document.referrer,this.client_memory.setItem("callkeep_rfr",this.rfr),ck_debug&&console.log("defineReferrer() - Установлен referrer: "+this.rfr)},e.prototype.activateUserForms=function(){function e(e){var t=jQuery(this).val().replace(/\D/g,""),i=jQuery(this).closest("form.dw-uform").find(".dw-uform-submit").eq(0);11!=t.length?i.attr("disabled","disabled"):i.removeAttr("disabled")}function t(e){function t(e,t,a){var _=JSON.parse(e);return s.hide(),ck_debug&&console.log("Сабмит пользовательской формы: Получен ответ: "),ck_debug&&console.log(_),"error"==_.status?(n.text(_.text),ck_debug&&console.log("Сабмит пользовательской формы: Статус ответа - ошибка"),void("phone"==_.errorcode&&(ck_debug&&console.log("Сабмит пользовательской формы: ОШИБКА не верно введён телефон! Устанавливаю состояние form_was_activated и показываю форму."),r.val(""),o.attr("disabled","disabled"),l.show()))):("function"==typeof ga&&"false"!=c&&(ga("send","event","DialogWidget","DialogWidget Submit"),ga("send","event","DialogWidget","DialogWidget UserForm Sent")),"object"==typeof _gaq&&"function"==typeof _gaq.push&&"false"!=c&&(_gaq.push(["_trackEvent","DialogWidget","DialogWidget Submit"]),_gaq.push(["_trackEvent","DialogWidget","DialogWidget UserForm Sent"])),i.ya_c&&window["yaCounter"+i.ya_c].reachGoal("DialogWidget_Submit"),"function"==typeof DialogWidgetSubmit?(ck_debug&&console.log("Сабмит формы: DialogWidgetSubmit запуск функции"),DialogWidgetSubmit()):ck_debug&&console.log("Сабмит формы: DialogWidgetSubmit функция не найдена"),n.text(_.text),_.wh||ck_debug&&console.log("Сабмит пользовательской формы: Время не рабочее показываю благодарность."),i.i_acted=!0,void i.client_memory.setItem("callkeep_cst","form_was_submitted"))}e.preventDefault();var o=jQuery(this),l=o.closest("form.dw-uform"),c=l.data("dw-events")===!1?"false":"",a=l.data("dw-onlycall")===!0?"true":"",n=l.parent().find(".dw-uform-phrase").eq(0),s=l.siblings("img.dw-uform-load-image").eq(0),r=l.find("input.dw-uform-phone").eq(0),_=o.data("dw-uform-hint"),p="";n.data("dw-shown-phrase")||n.data("dw-shown-phrase",n.text()),p+="ck_phone="+r.val().replace(/\D/g,""),p+="&ck_ep="+encodeURIComponent(i.client_memory.getItem("callkeep_ep")),p+="&ck_ep_title="+encodeURIComponent(i.client_memory.getItem("callkeep_ept")),p+="&ck_act_phrase="+encodeURIComponent(n.data("dw-shown-phrase")),p+="&ck_hint="+encodeURIComponent(_),p+="&ck_phr_type=uform",p+="&ck_actp="+encodeURIComponent(window.location.pathname),p+="&ck_actp_title="+encodeURIComponent(jQuery("title").text()),p+="&ck_openstat="+(i.client_memory.getItem("callkeep_os")||""),p+="&ck_camp="+(i.client_memory.getItem("callkeep_utmcamp")||""),p+="&op=lead",p+="&wid="+i.wid,p+="&source="+(i.client_memory.getItem("callkeep_rfr")||""),p+="&utm_src="+(i.client_memory.getItem("callkeep_utmsrc")||""),p+="&gclid="+(i.client_memory.getItem("callkeep_gclid")||""),p+="&onlycall="+a,l.hide(),s.show(),ck_debug&&console.log("activateUserForms() - данные запроса: "+p),jQuery.ajax({type:"POST",url:i.fc,data:p,success:t})}var i=this,o=jQuery("form.dw-uform");if(0==o.length)return void(ck_debug&&console.log("activateUserForms(): Не найдено пользовательских форм. Ничего не делаю..."));var l=i.checkWh(),c=jQuery('<img src="'+i.dp+i.imgp+'loading.gif" class="dw-uform-load-image">');o.each(function(i){var o=jQuery(this),a=o.find(".dw-uform-submit").eq(0),n=o.find(".dw-uform-phone").eq(0),s=o.parent().find(".dw-uform-phrase").eq(0);a.length>0&&n.length>0&&(a.attr("disabled","disabled").unbind("click"),n.keyup(e),n.attr("type","tel"),o.unbind("submit").addClass("dw-uform-active"),c.clone().insertBefore(o),s.length>0&&s.data("dw-wh-phr")&&s.data("dw-nwh-phr")&&(l?s.html(s.data("dw-wh-phr")):s.html(s.data("dw-nwh-phr"))),a.click(t))}),"function"!=typeof jQuery.mask?(ck_debug&&console.log("activateUserForms(): Функция .mask - не функция :) Наверно плагин Masked Input не установлен. Подключаю плагин от себя..."),jQuery.getScript(this.dp+"/jquery.maskedinput.js",function(e){jQuery("form.dw-uform-active input.dw-uform-phone").attr("placeholder","_ (___) ___-__-__").mask("9 (999) 999-99-99",{placeholder:"_"})})):jQuery("form.dw-uform-active input.dw-uform-phone").attr("placeholder","_ (___) ___-__-__").mask("9 (999) 999-99-99",{placeholder:"_"})},e}(),DialogWidget.ActionCondition=function(){function e(e,t,i){if(this.av=e,this.asc=parseInt(t)||0,Object.defineProperty(this,"ca",{value:0,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"cuss",{value:0,writable:!0,enumerable:!1,configurable:!0}),this.vn="action_condition",Object.defineProperty(this,"watcher_timer",{value:null,writable:!0,enumerable:!1,configurable:!0}),!(i instanceof DialogWidget.DW))throw new Error("ActionCondition _constructor - Объекту условия надо передавать экземпляр основного объекта DW!!!");Object.defineProperty(this,"main_ck_obj",{value:i,writable:!0,enumerable:!1,configurable:!0})}return e.prototype.createConditionObject=function(e,t,i,o){if(!(parseInt(i)>0))return console.log("ОШИБКА! ActionCondition.prototype.createConditionObject: при создании условия "+e+" - activ_score должен быть положительным числом больше 0"),!1;switch(e){case"sess_time":return new DialogWidget.ActCond_Session_Time(t,i,o)}return console.log("ОШИБКА! ActionCondition.prototype.createConditionObject: не нашлось условий с именем переменной "+e),!1},e.prototype.startWatching=function(){throw new Error("ActionCondition.startWatching - абстрактная функция должна реализовываться во всех подклассах!")},e.prototype.stopWatching=function(){clearInterval(this.watcher_timer),this.cuss=0},e.prototype.giveSumScore=function(){var e=this.cuss;return this.cuss=0,e},e}(),DialogWidget.ActCond_Session_Time=function(){function e(e,t,i){DialogWidget.ActionCondition.call(this,e,t,i),this.vn="sess_time",this.startWatching=function(){function e(){if(i.im_responsible){var e,o=t;e=o.asc/o.av,o.cuss+=parseFloat(e.toFixed(3))}}var t=this,i=this.main_ck_obj;this.watcher_timer=setInterval(e,1e3)}}return e.prototype=DialogWidget.ActionCondition.prototype,e.prototype.constructor=e,e}(),DialogWidget.CallKeepCookieHandler=function(){function e(e,t){function i(){var e={},t=document.cookie;""===t&&(c=e);for(var i=t.split("; "),a=0;a<i.length;a++){var n=i[a],s=n.indexOf("="),r=n.substring(0,s),_=n.substring(s+1);try{_=decodeURIComponent(_)}catch(p){ck_debug&&console.log("CallKeepCookieHandler - loadCookies - ошибка не получилось раскодировать значение: "+_+" пишем его в сыром виде")}e[r]=_}o=[];for(var m in e)o.push(m);l=o.length,c=e}var o=[],l=0,c={};i(),this.key=function(e){return 0>e||e>=o.length?null:o[e]},this.getItem=function(e){return i(),c[e]||null},this.setItem=function(a,n){i(),a in c||(o.push(a),l++),c[a]=n;var s=a+"="+encodeURIComponent(n);e&&(s+="; max-age="+e),t&&(s+="; path="+t),document.cookie=s},this.removeItem=function(e){if(i(),e in c){delete c[e];for(var t=0,a=o.length;a>t;t++)if(o[t]===e){o.splice(t,1);break}l--,document.cookie=e+"=; max-age=0"}},this.clear=function(){this.removeItem("callkeep_vers"),this.removeItem("callkeep_rfr"),this.removeItem("callkeep_ep"),this.removeItem("callkeep_ept"),this.removeItem("callkeep_eph1"),this.removeItem("callkeep_os"),this.removeItem("callkeep_utmcamp"),this.removeItem("callkeep_utmsrc"),this.removeItem("callkeep_gclid"),this.removeItem("callkeep_cst"),this.removeItem("callkeep_cs"),this.removeItem("callkeep_aw"),this.removeItem("callkeep_rflc"),this.removeItem("callkeep_lat"),this.removeItem("callkeep_lst"),this.removeItem("callkeep_fst"),this.removeItem("callkeep_ts"),this.removeItem("callkeep_lct"),this.removeItem("callkeep_summsec"),this.removeItem("callkeep_main"),this.removeItem("callkeep_act_cond")}}return e}(),DialogWidget.CallKeepLocalStorageHandler=function(){function e(){var e=window.localStorage;this.getItem=function(t){return e.getItem(t)},this.setItem=function(t,o){function l(e){var t=!1;if(e)if(e.code)switch(e.code){case 22:t=!0;break;case 1014:"NS_ERROR_DOM_QUOTA_REACHED"===e.name&&(t=!0)}else-2147024882===e.number&&(t=!0);return t}try{e.setItem(t,o)}catch(c){if(l(c)){var a,n=new DialogWidget.CallKeepCookieHandler(2592e3,"/"),s=e.length,r=new RegExp("^callkeep_","i");for(i=0;i<s;i++)a=e.key(i),a.match(r)&&n.setItem(a,e.getItem(a));DialogWidget.globalDW.client_memory=n,DialogWidget.globalDW.client_memory.setItem(t,o),this.clear(),console.log("DW Error: LocalStorage переполнен. Переключюсь на Cookies")}}},this.removeItem=function(t){e.removeItem(t)},this.clear=function(){e.removeItem("callkeep_vers"),e.removeItem("callkeep_rfr"),e.removeItem("callkeep_ep"),e.removeItem("callkeep_ept"),e.removeItem("callkeep_eph1"),e.removeItem("callkeep_os"),e.removeItem("callkeep_utmcamp"),e.removeItem("callkeep_utmsrc"),e.removeItem("callkeep_gclid"),e.removeItem("callkeep_cst"),e.removeItem("callkeep_cs"),e.removeItem("callkeep_aw"),e.removeItem("callkeep_rflc"),e.removeItem("callkeep_lat"),e.removeItem("callkeep_lst"),e.removeItem("callkeep_fst"),e.removeItem("callkeep_lct"),e.removeItem("callkeep_ts"),e.removeItem("callkeep_summsec"),e.removeItem("callkeep_main"),e.removeItem("callkeep_act_cond")}}return e}();var ck_debug=!1,ck_debug_periods=!1;"function"==typeof jQuery?jQuery(function(e){var t=e("#dw_script");t.is("script")&&t.data("dwk")&&(DialogWidget.globalDW=new DialogWidget.DW(t.data("dwk")),DialogWidget.globalDW.init())}):console.log("DW Error: jQuery не найдена. Запуск отменён.");